import {describe} from "mocha";

const path = require("path");
const wasm_tester = require("circom_tester").wasm;

// inputs MUST be generated by GO-CIRCUITS library https://github.com/iden3/go-circuits (using corresponding test)
describe("sybilTest.circom:", async function() {

    const tests = [
        // {desc: "Ownership true. User state: not-genesis. Auth claims total/signedWith/revoked: 1/1/none", inputs: {genesisID: "19104853439462320209059061537253618984153217267677512271018416655565783041", profileNonce: "0", authClaim: ["301485908906857522017021291028488077057", "0", "4720763745722683616702324599137259461509439547324750011830105416383780791263", "4844030361230692908091131578688419341633213823133966379083981236400104720538", "16547485850637761685", "0", "0", "0"], authClaimIncMtp: ["20705360459443886266589173521200199826970601318029396875976898748762842059297", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], authClaimNonRevMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], authClaimNonRevMtpAuxHi: "0", authClaimNonRevMtpAuxHv: "0", authClaimNonRevMtpNoAux: "1", challenge: "12345", challengeSignatureR8x: "15829360093371098546177008474519342171461782120259125067189481965541223738777", challengeSignatureR8y: "10840522802382821290541462398953040493080116495308402635486440290351677745960", challengeSignatureS: "1196477404779941775725836688033485533497812196897664950083199167075327114562", claimsTreeRoot: "6984610952247418323757666775772385794275837910148332707634157199038140910110", revTreeRoot: "0", rootsTreeRoot: "0", state: "21113804037250189000799544443714429575956552660749022584991067995298527468524", gistRoot: "8364809448271980031740809272009123642667894182754198753132121401485119560119", gistMtp: ["1243904711429961858774220647610724273798918457991486031567244100767259239747", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], gistMtpAuxHi: "0", gistMtpAuxHv: "0", gistMtpNoAux: "0"}, expOut: {userID: "19104853439462320209059061537253618984153217267677512271018416655565783041", gistRoot: "8364809448271980031740809272009123642667894182754198753132121401485119560119", challenge: "12345"}},
  ];

    let circuit;
    this.timeout(300000)

    before(async () => {
        circuit = await wasm_tester(
            path.join(__dirname, "../circuits", "sybilTest.circom"),
            {
                output: path.join(__dirname, "../circuits", "build/sybil"),
                recompile: true,
                reduceConstraints: false,
            },
        );
    });

    tests.forEach(({desc, inputs, expOut}) => {
        it(`auth ${desc}`, async function() {
            const w = await circuit.calculateWitness(inputs, true);
            await circuit.checkConstraints(w);
            await circuit.assertOut(w, expOut);
        });
    });
});
