import {describe} from "mocha";

const path = require("path");
const wasmTester = require("circom_tester").wasm;
const chai = require("chai");
const expect = chai.expect;

describe("Test credentialAtomicQuerySigV2.circom", function () {

    this.timeout(600000);

    let circuit;

    before(async () => {
        circuit = await wasmTester(
            path.join(__dirname, "../../circuits/offchain", "credentialAtomicQuerySigV2.circom"),
            {
                output: path.join(__dirname, "circuits", "build"),
                recompile: true,
                reduceConstraints: false,
            },
        );

    });

    after(async () => {
        circuit.release()
    })

    const tests = [
        {"desc":"JSON-LD proof non inclusion. UserID = Subject. UserID out. User nonce = 0, Subject nonce = 0 claim issued on userID (Merklized claim)","inputs":{"requestID":"23","userGenesisID":"23148936466334350744548790012294489365207440754509988986684797708370051073","profileNonce":"0","claimSubjectProfileNonce":"0","issuerID":"21933750065545691586450392143787330185992517860945727248803138245838110721","issuerClaim":["14472269431592746875347367665757389417422","23148936466334350744548790012294489365207440754509988986684797708370051073","17568057213828477233507447080689055308823020388972334380526849356111335110900","0","30803922965249841627828060170","0","0","0"],"issuerClaimNonRevClaimsTreeRoot":"20643387758736831799596675626240785455902781070167728593409367019626753600795","issuerClaimNonRevRevTreeRoot":"0","issuerClaimNonRevRootsTreeRoot":"0","issuerClaimNonRevState":"2943483356559152311923412925436024635269538717812859789851139200242297094","issuerClaimNonRevMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerClaimNonRevMtpAuxHi":"0","issuerClaimNonRevMtpAuxHv":"0","issuerClaimNonRevMtpNoAux":"1","claimSchema":"180410020913331409885634153623124536270","issuerClaimSignatureR8x":"16040911300643389087133289197280903408637469426127492280866768920345924378805","issuerClaimSignatureR8y":"19031885154371660080142259857483717581648221991555571973619296380694440069623","issuerClaimSignatureS":"1222459322759091234535554313867040847532955367435200603686472935613253652327","issuerAuthClaim":["80551937543569765027552589160822318028","0","18843627616807347027405965102907494712213509184168391784663804560181782095821","21769574296201138406688395494914474950554632404504713590270198507141791084591","17476719578317212277","0","0","0"],"issuerAuthClaimMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerAuthClaimNonRevMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerAuthClaimNonRevMtpAuxHi":"0","issuerAuthClaimNonRevMtpAuxHv":"0","issuerAuthClaimNonRevMtpNoAux":"1","issuerAuthClaimsTreeRoot":"20643387758736831799596675626240785455902781070167728593409367019626753600795","issuerAuthRevTreeRoot":"0","issuerAuthRootsTreeRoot":"0","claimPathNotExists":"1","claimPathMtp":["5559250731000753554753485016695600829384855452867544273344893815961938985436","8572801910485227983539995488533475408768322385604766084351333237918158876183","0","21558280644890495634574226008223308568148491750171125081160458621552477288821","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"claimPathMtpNoAux":"0","claimPathMtpAuxHi":"15924483770554419123485443865253852621108414928056512791337538323107671760706","claimPathMtpAuxHv":"3649436878755004634629983548864752783389248075618975309339506929996626029578","claimPathKey":"4565618812218816904592638866963205946316329857551756884889133933625594842882","claimPathValue":"0","operator":0,"slotIndex":0,"timestamp":"1642074362","isRevocationChecked":1,"value":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"]},"expOut":{"requestID":"23","userID":"23148936466334350744548790012294489365207440754509988986684797708370051073","issuerID":"21933750065545691586450392143787330185992517860945727248803138245838110721","issuerAuthState":"2943483356559152311923412925436024635269538717812859789851139200242297094","issuerClaimNonRevState":"2943483356559152311923412925436024635269538717812859789851139200242297094","claimSchema":"180410020913331409885634153623124536270","slotIndex":"0","operator":0,"value":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"timestamp":"1642074362","merklized":"1","claimPathNotExists":"1"}},
        {"desc":"UserID != Subject. UserID out. User nonce = 0. Claim issued on Profile (subject nonce = 999) (Merklized claim)","inputs":{"requestID":"23","userGenesisID":"23148936466334350744548790012294489365207440754509988986684797708370051073","profileNonce":"0","claimSubjectProfileNonce":"999","issuerID":"21933750065545691586450392143787330185992517860945727248803138245838110721","issuerClaim":["14472269431592746875347367665757389417422","24497320812635010775435456013830217801375919178980935564312517783529521153","17568057213828477233507447080689055308823020388972334380526849356111335110900","0","30803922965249841627828060170","0","0","0"],"issuerClaimNonRevClaimsTreeRoot":"20643387758736831799596675626240785455902781070167728593409367019626753600795","issuerClaimNonRevRevTreeRoot":"0","issuerClaimNonRevRootsTreeRoot":"0","issuerClaimNonRevState":"2943483356559152311923412925436024635269538717812859789851139200242297094","issuerClaimNonRevMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerClaimNonRevMtpAuxHi":"0","issuerClaimNonRevMtpAuxHv":"0","issuerClaimNonRevMtpNoAux":"1","claimSchema":"180410020913331409885634153623124536270","issuerClaimSignatureR8x":"20182323053626007196087938606884171693034410400799266202280743366729604996440","issuerClaimSignatureR8y":"20529421457864985372585403202509060910666604521668250902043119365522293707370","issuerClaimSignatureS":"121413623054693703954134599567469283900692572593162039605756532017839005547","issuerAuthClaim":["80551937543569765027552589160822318028","0","18843627616807347027405965102907494712213509184168391784663804560181782095821","21769574296201138406688395494914474950554632404504713590270198507141791084591","17476719578317212277","0","0","0"],"issuerAuthClaimMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerAuthClaimNonRevMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerAuthClaimNonRevMtpAuxHi":"0","issuerAuthClaimNonRevMtpAuxHv":"0","issuerAuthClaimNonRevMtpNoAux":"1","issuerAuthClaimsTreeRoot":"20643387758736831799596675626240785455902781070167728593409367019626753600795","issuerAuthRevTreeRoot":"0","issuerAuthRootsTreeRoot":"0","claimPathNotExists":"0","claimPathMtp":["5559250731000753554753485016695600829384855452867544273344893815961938985436","20222899544143787877985297439625828822272100269106711904511119118819809140477","14730426618666280941604039095550905490156541514901979358549599762282042588641","20497288520738821800886677250569208588689763166335933087499619993954968899866","3295720551404287572425718873751040314503774617833462052445584373469655789999","796356776410152646380783209242693344675665178494017735650545708722024766291","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"claimPathMtpNoAux":"0","claimPathMtpAuxHi":"0","claimPathMtpAuxHv":"0","claimPathKey":"8566939875427719562376598811066985304309117528846759529734201066483458512800","claimPathValue":"1420070400000000000","operator":1,"slotIndex":2,"timestamp":"1642074362","isRevocationChecked":1,"value":["1420070400000000000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"]},"expOut":{"requestID":"23","userID":"23148936466334350744548790012294489365207440754509988986684797708370051073","issuerID":"21933750065545691586450392143787330185992517860945727248803138245838110721","issuerAuthState":"2943483356559152311923412925436024635269538717812859789851139200242297094","issuerClaimNonRevState":"2943483356559152311923412925436024635269538717812859789851139200242297094","claimSchema":"180410020913331409885634153623124536270","slotIndex":"2","operator":1,"value":["1420070400000000000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"timestamp":"1642074362","merklized":"1","claimPathNotExists":"0"}},
        {"desc":"UserID == Subject. UserProfile out. User nonce = 10. Claim issued on Profile (subject nonce = 999) (Merklized claim)","inputs":{"requestID":"23","userGenesisID":"23148936466334350744548790012294489365207440754509988986684797708370051073","profileNonce":"10","claimSubjectProfileNonce":"999","issuerID":"21933750065545691586450392143787330185992517860945727248803138245838110721","issuerClaim":["14472269431592746875347367665757389417422","24497320812635010775435456013830217801375919178980935564312517783529521153","17568057213828477233507447080689055308823020388972334380526849356111335110900","0","30803922965249841627828060170","0","0","0"],"issuerClaimNonRevClaimsTreeRoot":"20643387758736831799596675626240785455902781070167728593409367019626753600795","issuerClaimNonRevRevTreeRoot":"0","issuerClaimNonRevRootsTreeRoot":"0","issuerClaimNonRevState":"2943483356559152311923412925436024635269538717812859789851139200242297094","issuerClaimNonRevMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerClaimNonRevMtpAuxHi":"0","issuerClaimNonRevMtpAuxHv":"0","issuerClaimNonRevMtpNoAux":"1","claimSchema":"180410020913331409885634153623124536270","issuerClaimSignatureR8x":"20182323053626007196087938606884171693034410400799266202280743366729604996440","issuerClaimSignatureR8y":"20529421457864985372585403202509060910666604521668250902043119365522293707370","issuerClaimSignatureS":"121413623054693703954134599567469283900692572593162039605756532017839005547","issuerAuthClaim":["80551937543569765027552589160822318028","0","18843627616807347027405965102907494712213509184168391784663804560181782095821","21769574296201138406688395494914474950554632404504713590270198507141791084591","17476719578317212277","0","0","0"],"issuerAuthClaimMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerAuthClaimNonRevMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerAuthClaimNonRevMtpAuxHi":"0","issuerAuthClaimNonRevMtpAuxHv":"0","issuerAuthClaimNonRevMtpNoAux":"1","issuerAuthClaimsTreeRoot":"20643387758736831799596675626240785455902781070167728593409367019626753600795","issuerAuthRevTreeRoot":"0","issuerAuthRootsTreeRoot":"0","claimPathNotExists":"0","claimPathMtp":["5559250731000753554753485016695600829384855452867544273344893815961938985436","20222899544143787877985297439625828822272100269106711904511119118819809140477","14730426618666280941604039095550905490156541514901979358549599762282042588641","20497288520738821800886677250569208588689763166335933087499619993954968899866","3295720551404287572425718873751040314503774617833462052445584373469655789999","796356776410152646380783209242693344675665178494017735650545708722024766291","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"claimPathMtpNoAux":"0","claimPathMtpAuxHi":"0","claimPathMtpAuxHv":"0","claimPathKey":"8566939875427719562376598811066985304309117528846759529734201066483458512800","claimPathValue":"1420070400000000000","operator":1,"slotIndex":2,"timestamp":"1642074362","isRevocationChecked":1,"value":["1420070400000000000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"]},"expOut":{"requestID":"23","userID":"19816097857299506276751016592539988756969255304244082727801276212869922817","issuerID":"21933750065545691586450392143787330185992517860945727248803138245838110721","issuerAuthState":"2943483356559152311923412925436024635269538717812859789851139200242297094","issuerClaimNonRevState":"2943483356559152311923412925436024635269538717812859789851139200242297094","claimSchema":"180410020913331409885634153623124536270","slotIndex":"2","operator":1,"value":["1420070400000000000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"timestamp":"1642074362","merklized":"1","claimPathNotExists":"0"}},
        {"desc":"UserID != Subject. UserProfile out. User nonce = 10. Claim issued on Profile (subject nonce = 0) (Merklized claim)","inputs":{"requestID":"23","userGenesisID":"23148936466334350744548790012294489365207440754509988986684797708370051073","profileNonce":"10","claimSubjectProfileNonce":"0","issuerID":"21933750065545691586450392143787330185992517860945727248803138245838110721","issuerClaim":["14472269431592746875347367665757389417422","23148936466334350744548790012294489365207440754509988986684797708370051073","17568057213828477233507447080689055308823020388972334380526849356111335110900","0","30803922965249841627828060170","0","0","0"],"issuerClaimNonRevClaimsTreeRoot":"20643387758736831799596675626240785455902781070167728593409367019626753600795","issuerClaimNonRevRevTreeRoot":"0","issuerClaimNonRevRootsTreeRoot":"0","issuerClaimNonRevState":"2943483356559152311923412925436024635269538717812859789851139200242297094","issuerClaimNonRevMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerClaimNonRevMtpAuxHi":"0","issuerClaimNonRevMtpAuxHv":"0","issuerClaimNonRevMtpNoAux":"1","claimSchema":"180410020913331409885634153623124536270","issuerClaimSignatureR8x":"16040911300643389087133289197280903408637469426127492280866768920345924378805","issuerClaimSignatureR8y":"19031885154371660080142259857483717581648221991555571973619296380694440069623","issuerClaimSignatureS":"1222459322759091234535554313867040847532955367435200603686472935613253652327","issuerAuthClaim":["80551937543569765027552589160822318028","0","18843627616807347027405965102907494712213509184168391784663804560181782095821","21769574296201138406688395494914474950554632404504713590270198507141791084591","17476719578317212277","0","0","0"],"issuerAuthClaimMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerAuthClaimNonRevMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerAuthClaimNonRevMtpAuxHi":"0","issuerAuthClaimNonRevMtpAuxHv":"0","issuerAuthClaimNonRevMtpNoAux":"1","issuerAuthClaimsTreeRoot":"20643387758736831799596675626240785455902781070167728593409367019626753600795","issuerAuthRevTreeRoot":"0","issuerAuthRootsTreeRoot":"0","claimPathNotExists":"0","claimPathMtp":["5559250731000753554753485016695600829384855452867544273344893815961938985436","20222899544143787877985297439625828822272100269106711904511119118819809140477","14730426618666280941604039095550905490156541514901979358549599762282042588641","20497288520738821800886677250569208588689763166335933087499619993954968899866","3295720551404287572425718873751040314503774617833462052445584373469655789999","796356776410152646380783209242693344675665178494017735650545708722024766291","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"claimPathMtpNoAux":"0","claimPathMtpAuxHi":"0","claimPathMtpAuxHv":"0","claimPathKey":"8566939875427719562376598811066985304309117528846759529734201066483458512800","claimPathValue":"1420070400000000000","operator":1,"slotIndex":2,"timestamp":"1642074362","isRevocationChecked":1,"value":["1420070400000000000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"]},"expOut":{"requestID":"23","userID":"19816097857299506276751016592539988756969255304244082727801276212869922817","issuerID":"21933750065545691586450392143787330185992517860945727248803138245838110721","issuerAuthState":"2943483356559152311923412925436024635269538717812859789851139200242297094","issuerClaimNonRevState":"2943483356559152311923412925436024635269538717812859789851139200242297094","claimSchema":"180410020913331409885634153623124536270","slotIndex":"2","operator":1,"value":["1420070400000000000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"timestamp":"1642074362","merklized":"1","claimPathNotExists":"0"}},
        {"desc":"UserID == Subject. UserID out. User nonce = 0, Subject nonce = 0 claim issued on userID (Claim)","inputs":{"requestID":"23","userGenesisID":"23148936466334350744548790012294489365207440754509988986684797708370051073","profileNonce":"0","claimSubjectProfileNonce":"0","issuerID":"21933750065545691586450392143787330185992517860945727248803138245838110721","issuerClaim":["3583233690122716044519380227940806650830","23148936466334350744548790012294489365207440754509988986684797708370051073","10","0","30803922965249841627828060161","0","0","0"],"issuerClaimNonRevClaimsTreeRoot":"20643387758736831799596675626240785455902781070167728593409367019626753600795","issuerClaimNonRevRevTreeRoot":"0","issuerClaimNonRevRootsTreeRoot":"0","issuerClaimNonRevState":"2943483356559152311923412925436024635269538717812859789851139200242297094","issuerClaimNonRevMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerClaimNonRevMtpAuxHi":"0","issuerClaimNonRevMtpAuxHv":"0","issuerClaimNonRevMtpNoAux":"1","claimSchema":"180410020913331409885634153623124536270","issuerClaimSignatureR8x":"6009541096871527792243386384096231340067474190101091530507148551135935669869","issuerClaimSignatureR8y":"21407298901003665469054234025891175478757417093942142815529365365949388290718","issuerClaimSignatureS":"1061441685873832236639155829779552898548912415538872104865210006348646647963","issuerAuthClaim":["80551937543569765027552589160822318028","0","18843627616807347027405965102907494712213509184168391784663804560181782095821","21769574296201138406688395494914474950554632404504713590270198507141791084591","17476719578317212277","0","0","0"],"issuerAuthClaimMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerAuthClaimNonRevMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerAuthClaimNonRevMtpAuxHi":"0","issuerAuthClaimNonRevMtpAuxHv":"0","issuerAuthClaimNonRevMtpNoAux":"1","issuerAuthClaimsTreeRoot":"20643387758736831799596675626240785455902781070167728593409367019626753600795","issuerAuthRevTreeRoot":"0","issuerAuthRootsTreeRoot":"0","claimPathNotExists":"0","claimPathMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"claimPathMtpNoAux":"0","claimPathMtpAuxHi":"0","claimPathMtpAuxHv":"0","claimPathKey":"0","claimPathValue":"0","operator":1,"slotIndex":2,"timestamp":"1642074362","isRevocationChecked":1,"value":["10","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"]},"expOut":{"requestID":"23","userID":"23148936466334350744548790012294489365207440754509988986684797708370051073","issuerID":"21933750065545691586450392143787330185992517860945727248803138245838110721","issuerAuthState":"2943483356559152311923412925436024635269538717812859789851139200242297094","issuerClaimNonRevState":"2943483356559152311923412925436024635269538717812859789851139200242297094","claimSchema":"180410020913331409885634153623124536270","slotIndex":"2","operator":1,"value":["10","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"timestamp":"1642074362","merklized":"0","claimPathNotExists":"0"}},
        {"desc":"User's claim revoked and the circuit not checking for revocation status","inputs":{"requestID":"23","userGenesisID":"23148936466334350744548790012294489365207440754509988986684797708370051073","profileNonce":"0","claimSubjectProfileNonce":"0","issuerID":"21933750065545691586450392143787330185992517860945727248803138245838110721","issuerClaim":["3583233690122716044519380227940806650830","23148936466334350744548790012294489365207440754509988986684797708370051073","10","0","30803922965249841627828060161","0","0","0"],"issuerClaimNonRevClaimsTreeRoot":"20643387758736831799596675626240785455902781070167728593409367019626753600795","issuerClaimNonRevRevTreeRoot":"19374975721259875597650302716689543547647001662517455822229477759190533109280","issuerClaimNonRevRootsTreeRoot":"0","issuerClaimNonRevState":"20420704177203139055971454163395877029462021737850567671726924780413332537","issuerClaimNonRevMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerClaimNonRevMtpAuxHi":"0","issuerClaimNonRevMtpAuxHv":"0","issuerClaimNonRevMtpNoAux":"0","claimSchema":"180410020913331409885634153623124536270","issuerClaimSignatureR8x":"6009541096871527792243386384096231340067474190101091530507148551135935669869","issuerClaimSignatureR8y":"21407298901003665469054234025891175478757417093942142815529365365949388290718","issuerClaimSignatureS":"1061441685873832236639155829779552898548912415538872104865210006348646647963","issuerAuthClaim":["80551937543569765027552589160822318028","0","18843627616807347027405965102907494712213509184168391784663804560181782095821","21769574296201138406688395494914474950554632404504713590270198507141791084591","17476719578317212277","0","0","0"],"issuerAuthClaimMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerAuthClaimNonRevMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"issuerAuthClaimNonRevMtpAuxHi":"1","issuerAuthClaimNonRevMtpAuxHv":"0","issuerAuthClaimNonRevMtpNoAux":"0","issuerAuthClaimsTreeRoot":"20643387758736831799596675626240785455902781070167728593409367019626753600795","issuerAuthRevTreeRoot":"19374975721259875597650302716689543547647001662517455822229477759190533109280","issuerAuthRootsTreeRoot":"0","claimPathNotExists":"0","claimPathMtp":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"claimPathMtpNoAux":"0","claimPathMtpAuxHi":"0","claimPathMtpAuxHv":"0","claimPathKey":"0","claimPathValue":"0","operator":1,"slotIndex":2,"timestamp":"1642074362","isRevocationChecked":0,"value":["10","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"]},"expOut":{"requestID":"23","userID":"23148936466334350744548790012294489365207440754509988986684797708370051073","issuerID":"21933750065545691586450392143787330185992517860945727248803138245838110721","issuerAuthState":"20420704177203139055971454163395877029462021737850567671726924780413332537","issuerClaimNonRevState":"20420704177203139055971454163395877029462021737850567671726924780413332537","claimSchema":"180410020913331409885634153623124536270","slotIndex":"2","operator":1,"value":["10","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"timestamp":"1642074362","merklized":"0","claimPathNotExists":"0"}}
    ];

    tests.forEach(({desc, inputs, expOut}) => {
        it(`${desc}`, async function () {
            const w = await circuit.calculateWitness(inputs, true);
            await circuit.assertOut(w, expOut);
            await circuit.checkConstraints(w);
        });
    });


    it("Checking revoked status when claim is revoked (Sig)", async () => {
        const inputs = {
            "requestID": "23",
            "userGenesisID": "23148936466334350744548790012294489365207440754509988986684797708370051073",
            "profileNonce": "0",
            "claimSubjectProfileNonce": "0",
            "issuerID": "21933750065545691586450392143787330185992517860945727248803138245838110721",
            "issuerClaim": [
                "3583233690122716044519380227940806650830",
                "23148936466334350744548790012294489365207440754509988986684797708370051073",
                "10",
                "0",
                "30803922965249841627828060161",
                "0",
                "0",
                "0"
            ],
            "issuerClaimNonRevClaimsTreeRoot": "20643387758736831799596675626240785455902781070167728593409367019626753600795",
            "issuerClaimNonRevRevTreeRoot": "19374975721259875597650302716689543547647001662517455822229477759190533109280",
            "issuerClaimNonRevRootsTreeRoot": "0",
            "issuerClaimNonRevState": "20420704177203139055971454163395877029462021737850567671726924780413332537",
            "issuerClaimNonRevMtp": [
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0"
            ],
            "issuerClaimNonRevMtpAuxHi": "0",
            "issuerClaimNonRevMtpAuxHv": "0",
            "issuerClaimNonRevMtpNoAux": "0",
            "claimSchema": "180410020913331409885634153623124536270",
            "issuerClaimSignatureR8x": "6009541096871527792243386384096231340067474190101091530507148551135935669869",
            "issuerClaimSignatureR8y": "21407298901003665469054234025891175478757417093942142815529365365949388290718",
            "issuerClaimSignatureS": "1061441685873832236639155829779552898548912415538872104865210006348646647963",
            "issuerAuthClaim": [
                "80551937543569765027552589160822318028",
                "0",
                "18843627616807347027405965102907494712213509184168391784663804560181782095821",
                "21769574296201138406688395494914474950554632404504713590270198507141791084591",
                "17476719578317212277",
                "0",
                "0",
                "0"
            ],
            "issuerAuthClaimMtp": [
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0"
            ],
            "issuerAuthClaimNonRevMtp": [
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0"
            ],
            "issuerAuthClaimNonRevMtpAuxHi": "1",
            "issuerAuthClaimNonRevMtpAuxHv": "0",
            "issuerAuthClaimNonRevMtpNoAux": "0",
            "issuerAuthClaimsTreeRoot": "20643387758736831799596675626240785455902781070167728593409367019626753600795",
            "issuerAuthRevTreeRoot": "19374975721259875597650302716689543547647001662517455822229477759190533109280",
            "issuerAuthRootsTreeRoot": "0",
            "claimPathNotExists": "0",
            "claimPathMtp": [
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0"
            ],
            "claimPathMtpNoAux": "0",
            "claimPathMtpAuxHi": "0",
            "claimPathMtpAuxHv": "0",
            "claimPathKey": "0",
            "claimPathValue": "0",
            "operator": 1,
            "slotIndex": 2,
            "timestamp": "1642074362",
            "isRevocationChecked": 1,
            "value": [
                "10",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0"
            ]
        };

        let error;
        await circuit.calculateWitness(inputs, true).catch((err) => {
            error = err;
        });
        expect(error.message).to.include("Error in template checkClaimNotRevoked");
    });
});
